version: "3.9"
services:
  codes_spliter:
    restart: "no"
    image: node:14
    volumes:
      - ./codes_spliter:/app
    working_dir: /app
    entrypoint: ["node", "dist/index.js"]
    environment:
      NODE_ID: '{{.Task.Name}}'
    depends_on:
      - redis
  tr_connect:
    image: node:14
    volumes:
      - ./tr_connector:/app
    working_dir: /app
    entrypoint: ["node", "server.js"]
    environment:
      TR_SERVER: dev-tr.myspec.io
      TR_PORT: 5001
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: spec12!@
      STOCK_CODE_URL: https://test.myspec.io
      SERVER_ID: '{{.Task.Name}}'

    depends_on:
      - redis
  feed_publisher:
    image: node:14
    volumes:
      - ./feed_publisher:/app
    ports:
      - "3001:3001"
    working_dir: /app
    entrypoint: [ "node", "feed_publisher.js" ]
    environment:
      SERVER_PORT: 3001
      REDIS_HOST: redis
      REDIS_PORT: 6379
      REDIS_PASSWORD: spec12!@
      JWT_KEY: SPecAPIKey1212
      DEBUG: log.*
    depends_on:
      - redis
  feed_tester:
    image: node:14
    volumes:
      - ./feed_client:/app
    working_dir: /app
    entrypoint: [ "node", "subscriber1.js" ]
    deploy:
      replicas: 2
    environment:
      JWT: eyJhbGciOiJIUzUxMiJ9.eyJ1aWQiOiIxNTAyMTM3MDY5Iiwic3ViIjoiNDc0MjgiLCJzZXNzaW9uX2lkIjoiODFmODVjNjYtNzY0MS00YmFiLWJkNTktNjQ4MjIzMzMxNWNlIiwiaWQiOjQ3NDI4LCJleHAiOjE2MzQwOTk5NTYsImpvaW5fcGxhdGZvcm0iOiJLQUtBTyIsImlhdCI6MTYzMzY2Nzk1NiwiZW1haWwiOiJwcmlkZWtrQGdtYWlsLmNvbSJ9.M79VtOv0TDLFVYpB7X9VWtoM_Pvw1hpVrBvmtBN4P0UtOrlv5wWTZHPnjz22fuFChgBZ93cU9gAyTT9mWaG8CQ
      SERVER: 3.36.149.215
      PORT: 3001
      CODES: 000250,000440,001000,001540,001810,001840,002230,002290,002680,002800,003100,003310,003380,003800,004590,004650,004780,005160,005290,005670,005710,005860,005990,006050,006140,006580,006620,006730,006910,006920,007330,007370,007390,007530,007680,007720,007770,007820,008290,008370,008470,008800,008830,009300,009520,009620,009730,009780,010170,010240,010280,010470,011040,011080,011320,011370,011560,012340,012620,012700,012790,012860,013030,013120,013310,013720,013810,013990,014100,014190,014200,014470,014570,014620,014940,014970,015710,015750,016100,016250,016600,016670,016790,016920,017000,017250,017480,017510,017650,017890,018000,018120,018290,018310,018620,018680,018700,019010,019210,019540,019550,019570,019590,019660,019770,019990,020180,020400,020710,021040,021045,021080,021320,021650,021880,022100,022220,023160,023410,023440,023460,023600,023760,023770,023790,023890,023900,023910,024060,024120,024740,024800,024810,024830,024840,024850,024880,024910,024940,024950,025320,025440,025550,025770,025870,025880,025900,025950,025980,026040,026150,026910,027040,027050,027360,027580,027710,027830,028040,028080,028150,028300,029480,029960,030190,030350,030520,030530,030960,031310,031330,031390,031510,031860,031980,032080,032190,032280,032300,032500,032540,032580,032620,032680,032685,032750,032790,032800,032820,032850,032860,032940,032960,032980,033050,033100,033110,033130,033160,033170,033200,033230,033290,033310,033320,033340,033430,033500,033540,033560,033600,033640,033790,033830,034230,034810,034940,034950,035080,035200,035290,035460,035600,035610,035620,035760,035810,035890,035900,036000,036010,036030,036090,036120,036170,036180,036190,036200,036480,036490,036540,036560,036620,036630,036640,036670,036690,036710,036800,036810,036830,036890,036930,037030,037070,037230,037330,037350,037370,037400,037440,037460,037760,037950,038010,038060,038070,038110,038160,038290,038340,038390,038460,038500,038530,038540,038620,038680,038870,038880,038950,039010,039020,039030,039200,039230,039240,039290,039310,039340,039420,039440,039560,039610,039670,039740,039830,039840,039860,039980,040160,040300,040350,040420,040610,040910,041020,041140,041190,041440,041460,041510,041520,041590,041830,041910,041920,041930,041960,042000,042040,042110,042370,042420,042500,042510,042520,042600,042940,043090,043100,043150,043200,043220,043260,043290,043340,043360,043370,043590,043610,043650,043710,043910,044060,044180,044340,044480,044490,044780,044960,045060,045100,045300,045340,045390,045510,045520,045660,045890,045970,046070,046110,046120,046140,046210,046310,046390,046440,046890,046940,046970,047080,047310,047560,047770,047820,047920,048260,048410,048430,048470,048530,048550,048770,048830,048870,048910,049070,049080,049120,049180,049430,049470,049480,049520,049550,049630,049720,049830,049950,049960,050090,050110,050120,050320,050540,050760,050860,050890,050960,051160,051360,051370,051380,051390,051490,051500,051780,051980,052020,052190,052220,052260,052300,052330,052400,052420,052460,052600,052670,052710,052770,052790,052860,052900,053030,053050,053060,053080,053110,053160,053260,053270,053280,053290,053300,053350,053450,053580,053590,053610,053620,053660,053700,053800,053950,053980,054040,054050,054090,054180,054210,054220,054300,054410,054450,054540,054620,054630,054670,054780,054800,054920,054930,054940,054950,056000,056080,056090,056190,056360,056700,056730,057030,057540,057680,057880,058110,058220,058400,058420,058450,058470,058530,058610,058630,058820,058970,059090,059100,059120,059210,059270,060150,060230,060240,060250,060260,060280,060300,060310,060370,060380,060480,060540,060560,060570,060590,060720,060850,060900,061040,061250,061970,062860,062970,063080,063170,063440,063570,063760,064090,064240,064260,064290,064480,064510,064520,064550,064760,064800,064820,064850,065060,065130,065150,065170,065350,065370,065420,065440,065450,065500,065510,065530,065560,065570,065620,065650,065660,065680,065690,065710,065770,065950,066110,066130,066310,066360,066410,066430,066590,066620,066670,066700,066790,066900,066910,066970,066980,067000,067010,067080,067160,067170,067280,067290,067310,067390,067570,067630,067730,067770,067900,067920,067990,068050,068240,068330,068760,068790,068930,068940,069080,069110,069140,069330,069410,069510,069540,069920,070300,070590,071200,071280,071460,071670,071850,072020,072470,072520,072770,072870,072950,072990,073010,073070,073110,073190,073490,073540,073560,073570,073640,074430,074600,075130,075970,076080,076610,077360,078020,078070,078130,078140,078150,078160,078340,078350,078590,078600,078650,078860,078890,078940,079000,079170,079190,079370,079650,079810,079940,079950,079960,079970,080000,080010,080160,080220,080420,080440,080470,080520,080530,080580,080720,081150,081580,082210,082270,082660,082800,082850,082920,083310,083450,083470,083500,083550,083640,083650,083660,083790,083930,084110,084180,084370,084650,084730,084850,084990,085370,08537M,085660,085670,085810,085910,086040,086060,086250,086390,086450,086520,086670,086710,086820,086890,086900,086960,086980,087010,087260,087600,087730,088130,088290,088390,088800,088910,089010,089030,089140,089150,089230,089530,089600,089790,089850,089890,089970,089980,090150,090360,090410,090460,090470,090710,090740,090850,091120,091340,091440,091580,091590,091700,091970,091990,092040,092070,092130,092190,092300,092460,092600,092730,092870,093190,093320,093380,093520,093640,093920,094170,094360,094480,094820,094840,094850,094860,094940,094970,095190,095270,095340,095500,095610,095660,095700,095910,096040,096240,096350,096530,096610,096630,096640,096690,096870,097520,097780,097800,097870,098120,098460,098660,099190,099220,099320,099390,099410,099440,099520,099750,100030,100090,100120,100130,100590,100660,100700,100790,101000,101160,101170,101240,101330,101360,101390,101400,101490,101670,101680,101730,101930,102120,102210,102710,102940,103230,103840,104040,104200,104460,104480,104540,104620,104830,105330,105550,105740,106080,106190,106240,106520,108230,108320,108380,108490,108860,109080,109610,109740,109820,109860,109960,110020,110790,110990,111710,111820,111870,112040,113810,114120,114190,114450,114570,114630,114810,115160,115180,115310,115440,115450,115480,115500,115530,115570,115610,115960,117670,117730,118990,119500,119610,119830,119850,119860,120240,121440,121600,121800,121850,121890,122310,122350,122450,122640,122690,122870,122990,123010,123040,123330,123410,123420,123570,123750,123840,123860,124500,124560,125210,126340,126600,126640,126700,126870,126880,127120,127160,127710,128540,128660,129890,130500,130580,130740,131030,131090,131100,131180,131220,131290,131370,131390,131400,131760,131970,133750,134060,134580,136480,136510,136540,137400,137940,137950,138070,138080,138360,138580,138610,138690,139050,139670,140070,140410,140520,140670,140860,141000,141020,141070,141080,142210,142280,142760,143160,143240,143540,144510,144960,145020,147760,147830,148140,148150,148250,149950,149980,150840,150900,151860,151910,153460,153490,153710,154030,154040,155650,156100,158310,158430,159580,159910,160550,160600,160980,161570,161580,163730,164060,166090,166480,168330,169330,170030,170790,170920,171010,171090,171120,173130,173940,174880,174900,175140,175250,176440,177350,177830,178320,178780,178920,179290,179900,180400,181340,182360,182400,182690,183300,183490,184230,185490,186230,187220,187270,187420,187660,187790,187870,189300,189330,189690,189860,189980,190510,190650,191410,191420,192250,192390,192410,192440,193250,194480,194700,195440,195500,195940,195990,196170,196300,196450,196490,196700,197140,198080,198440,199820,200130,200230,200470,200670,200710,200780,201490,203450,203650,203690,204020,204270,204620,204630,204840,205100,205470,205500,206400,206560,206640,206650,207760,208140,208340,208350,208370,208640,208710,208860,211270,212560,213090,213420,214150,214180,214260,214270,214310,214370,214430,214450,214610,214680,214870,215000,215090,215100,215200,215360,215380,215480,215600,215790,216050,216080,217190,217270,217330,217480,217500,217600,217620,217730,217820,218150,218410,219130,219420,219550,219750,220100,220180,220260,220630,221610,221840,221980,222040,222080,222110,222420,222800,222810,222980,223250,223310,224060,224110,225190,225220,225330,225430,225530,225570,225590,226330,226340,226350,226360,226400,226440,226950,227100,227610,227950,228340,228670,228760,228850,229000,230240,230360,230980,232140,232680,234100,234300,234340,234690,234920,235980,236200,236810,237690,237750,237820,237880,238090,238120,238200,238490,239340,239610,239890,240810,241520,241690,241710,241770,241790,241820,241840,242040,243070,243840,244460,245620,246690,246710,246720,246960,247540,247660,250000,250060,250930,251370,251630,251970,252500,252990,253450,253590,253840,254120,255220,255440,256150,256630,256840,256940,257370,258610,258790,258830,259630,260660,260930,261200,262260,262840,263020,263050,263540,263600,263690,263700,263720,263750,263770,263800,263810,263860,263920,264450,264660,264850,265520,265560,265740,267320,267790,267980,268600,269620,270520,270660,270870,272110,272290,273060,274090,275630,276730,277070,277410,277810,277880,278280,278650,279600,281740,282880,284620,285490,286750,287410,288330,288620,289010,289080,289220,290120,290270,290380,290510,290520,290550,290650,290660,290670,290690,290720,290740,291230,291650,293490,293580,293780,294090,294140,294570,294630,297090,297570,297890,298060,298380,298540,299030,299170,299660,299900,299910,300080,300120,301300,302430,302550,303030,303530,304100,304840,305090,306040,306620,307070,307160,307180,307280,307750,307870,307930,308100,309930,310200,310840,310870,311270,311390,311690,312610,313750,313760,314130,314930,315640,317030,317120,317240,317320,317330,317530,317690,317770,317830,317850,317870,318000,318010,318020,318410,319400,319660,320000,321260,321550,321820,322180,322310,322510,322780,323210,323230,323280,323940,323990,327260,328380,329560,330350,330860,330990,331380,331520,331920,332290,332370,332570,332710,333050,333430,333620,334970,335810,335870,335890,336060,336570,337450,337930,338220,339950,340120,340350,340360,340440,340570,340930,341160,342550,343510,344050,347000,347140,347700,347740,347770,347860,347890,348030,348150,348210,348350,349720,351320,351330,351340,352480,352700,352770,352910,352940,353060,353070,353190,353490,353810,354200,355150,356860,356890,357230,357550,357580,357780,359090,361390,361670,363250,363260,365270,365590,366330,367000,367340,367360,367460,367480,368770,369370,372290,373200,373340,376190,376980,377030,377400,377630,380320,383310,386580,900070,900080,900100,900110,900120,900250,900260,900270,900280,900290,900300,900310,900340,950110,950130,950140,950160,950170,950180,950190,950200,950220,000020,000040,000050,000060,000070,000075,000080,000087,000100,000105,000120,000140,000145,000150,000155,000157,000180,000210,000215,000220,000225,000227,000230,000240,000270,000300,000320,000325,000370,000390,000400,000430,000480,000490,000500,000520,000540,000545,000547,000590,000640,000650,000660,000670,000680,000700,000720,000725,000760,000810,000815,000850,000860,000880,000885,00088K,000890,000910,000950,000970,000990,000995,001020,001040,001045,00104K,001060,001065,001067,001070,001080,001120,001130,001140,001200,001210,001230,001250,001260,001270,001275,001290,001340,001360,001380,001390,001420,001430,001440,001450,001460,001465,001470,001500,001510,001515,001520,001525,001527,001529,001530,001550,001560,001570,001620,001630,001680,001685,001720,001725,001740,001745,001750,001755,001770,001780,001790,001795,001800,001820,001880,001940,002020,002025,002030,002070,002100,002140,002150,002170,002200,002210,002220,002240,002270,002310,002320,002350,002355,002360,002380,002390,002410,002420,002450,002460,002600,002620,002630,002690,002700,002710,002720,002760,002780,002785,002787,002790,002795,00279K,002810,002820,002840,002870,002880,002900,002920,002960,002990,002995,003000,003010,003030,003060,003070,003075,003080,003090,003120,003160,003200,003220,003230,003240,003280,003300,003350,003410,003460,003465,003470,003475,003480,003490,003495,003520,003530,003535,003540,003545,003547,003550,003555,003560,003570,003580,003610,003620,003650,003670,003680,003690,003720,003780,003830,003850,003920,003925,003960,004000,004020,004060,004080,004090,004100,004105,004140,004150,004170,004250,004255,004270,004310,004360,004365,004370,004380,004410,004415,004430,004440,004450,004490,004540,004545,004560,004565,004690,004700,004710,004720,004770,004800,004830,004835,004840,004870,004890,004910,004920,004960,004970,004980,004985,004990,00499K,005010,005030,005070,005090,005110,005180,005190,005250,005257,005300,005305,005320,005360,005380,005385,005387,005389,005390,005420,005430,005440,005490,005500,005610,005680,005690,005720,005725,005740,005745,005750,005800,005810,005820,005830,005850,005870,005880,005930,005935,005940,005945,005950,005960,005965,006040,006060,006090,006110,006120,006125,006200,006220,006260,006280,006340,006345,006360,006370,006380,006390,006400,006405,006490,006570,006650,006660,006740,006800,006805,00680K,006840,006880,006890,006980,007070,007110,007120,007160,007210,007280,007310,007340,007460,007540,007570,007575,007590,007610,007630,007660,007690,007700,007810,007815,00781K,007860,007980,008040,008060,00806K,008110,008250,008260,008350,008355,008420,008490,008500,008560,008600,008700,008730,008770,008775,008870,008930,008970,009070,009140,009150,009155,009160,009180,009190,009200,009240,009270,009275,009290,009310,009320,009410,009415,009420,009440,009450,009460,009470,009540,009580,009680,009770,009810,009830,009835,009900,009970,010040,010050,010060,010100,010120,010130,010140,010145,010400,010420,010580,010600,010620,010640,010660,010690,010770,010780,010820,010950,010955,010960,011000,011070,011090,011150,011155,011170,011200,011210,011230,011280,011300,011330,011390,011420,011500,011690,011700,011760,011780,011785,011790,011810,011930,012030,012160,012170,012200,012205,012280,012320,012330,012450,012510,012600,012610,012630,012690,012750,012800,013000,013360,013520,013570,013580,013700,013870,013890,014130,014160,014280,014285,014440,014530,014580,014680,014710,014790,014820,014825,014830,014910,014915,014990,015020,015230,015260,015350,015360,015540,015590,015760,015860,015890,016090,016360,016380,016385,016450,016580,016590,016610,016710,016740,016800,016880,017040,017180,017370,017390,017550,017670,017800,017810,017900,017940,017960,018250,018260,018470,018500,018670,018880,019170,019175,019180,019440,019490,019680,019685,020000,020120,020150,020560,020760,021050,021240,021820,023000,023150,023350,023450,023530,023590,023800,023810,023960,024070,024090,024110,024720,024890,024900,025000,025530,025540,025560,025620,025750,025820,025860,025890,026890,026940,026960,027410,027740,027970,028050,028100,028260,02826K,028670,029460,029530,029780,030000,030200,030210,030610,030720,030790,031430,031440,031820,032350,032560,032640,032830,033180,033240,033250,033270,033530,033660,033780,033920,034020,034120,034220,034300,034310,034590,034730,03473K,034830,035000,035150,035250,035420,035510,035720,036420,036460,036530,036570,036580,037270,037560,037710,039130,039490,039570,041650,042660,042670,042700,044380,044450,044820,047040,047050,047400,047810,049770,049800,051600,051630,051900,051905,051910,051915,052690,053210,053690,055490,055550,057050,058430,058650,058730,058850,058860,060980,063160,064350,064960,066570,066575,067830,068270,068290,068400,069260,069460,069620,069640,069730,069960,070960,071050,071055,071090,071320,071840,071950,071970,072130,072710,073240,074610,075180,075580,077500,077970,078000,078520,078930,078935,079160,079430,079550,079980,081000,081660,082640,082740,083420,084010,084670,084680,084690,084695,084870,085310,085620,086280,086790,088350,088790,089470,089590,089860,090080,090350,090355,090370,090430,090435,091090,091810,092200,092220,092230,092440,092780,093050,093230,093240,093370,094280,095570,095720,096760,096770,096775,097230,097520,097950,097955,100220,100250,100840,101060,101140,101530,102260,102280,102460,103140,103590,104700,105560,105630,105840,107590,108670,108675,109070,111110,111770,112610,114090,115390,117580,118000,119650,120030,120110,120115,122900,123690,123700,123890,126560,128820,128940,129260,130660,133820,134380,134790,136490,137310,138040,138250,138490,138930,139130,139480,143210,144620,145210,145720,145990,145995,155660,161000,161390,161890,163560,170900,175330,178920,180640,18064K,181710,183190,185750,192080,192400,192650,192820,194370,195870,200880,204320,207940,210540,210980,213500,214320,214330,214390,214420,226320,227840,229640,234080,241560,241590,244920,248070,248170,249420,251270,259960,264900,26490K,267250,267260,267270,267290,267850,268280,271560,271980,272210,272450,272550,280360,281820,282330,282690,284740,285130,28513K,286940,293480,294870,298000,298020,298040,298050,298690,300720,302440,306200,307950,308170,316140,317400,322000,323410,326030,336260,33626K,33626L,336370,33637K,33637L,339770,344820,352820,353200,35320K,361610,363280,36328K,372910,375500,37550K,378850,380440,383220,383800,38380K,950210
    depends_on:
      - feed_publisher
  redis:
    image: redis
    volumes:
      - ./redis:/usr/local/etc/redis
    ports:
      - "7379:6379"
    dns: 8.8.8.8
    environment:
      TZ: Asia/Seoul